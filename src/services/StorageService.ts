import { Transaction, Account, Category } from '../types';\n\nclass StorageService {\n  private static instance: StorageService;\n  \n  static getInstance(): StorageService {\n    if (!StorageService.instance) {\n      StorageService.instance = new StorageService();\n    }\n    return StorageService.instance;\n  }\n\n  private safeParseJSON<T>(key: string, defaultValue: T): T {\n    try {\n      if (typeof window === 'undefined') return defaultValue;\n      const stored = localStorage.getItem(key);\n      return stored ? JSON.parse(stored) : defaultValue;\n    } catch (error) {\n      console.error(`Error parsing ${key} from localStorage:`, error);\n      return defaultValue;\n    }\n  }\n\n  private safeSetItem(key: string, value: any): void {\n    try {\n      if (typeof window !== 'undefined') {\n        localStorage.setItem(key, JSON.stringify(value));\n      }\n    } catch (error) {\n      console.error(`Error saving ${key} to localStorage:`, error);\n    }\n  }\n\n  getTransactions(): Transaction[] {\n    return this.safeParseJSON('financeData', []);\n  }\n\n  saveTransactions(transactions: Transaction[]): void {\n    this.safeSetItem('financeData', transactions);\n  }\n\n  getAccounts(): Account[] {\n    const accounts = this.safeParseJSON('financeAccounts', []);\n    if (accounts.length === 0) {\n      const defaultAccount: Account = {\n        id: Date.now().toString(),\n        name: 'Cuenta Principal',\n        type: 'savings',\n        isDefault: true,\n        initialBalance: 0,\n        creditLimit: 0,\n        cutoffDay: 1,\n        paymentDay: 10,\n        createdAt: new Date().toISOString()\n      };\n      this.saveAccounts([defaultAccount]);\n      return [defaultAccount];\n    }\n    return accounts;\n  }\n\n  saveAccounts(accounts: Account[]): void {\n    this.safeSetItem('financeAccounts', accounts);\n  }\n\n  getCategories(): Category {\n    return this.safeParseJSON('financeCategories', {\n      expense: ['Alimentación', 'Transporte', 'Servicios', 'Vivienda', 'Salud', 'Entretenimiento', 'Educación', 'Otros'],\n      income: ['Salario', 'Freelance', 'Inversiones', 'Otros']\n    });\n  }\n\n  saveCategories(categories: Category): void {\n    this.safeSetItem('financeCategories', categories);\n  }\n}\n\nexport const storageService = StorageService.getInstance();", "oldStr": "import { Transaction } from '../types';\n\nclass TransactionService {\n  private static instance: TransactionService;\n  \n  static getInstance(): TransactionService {\n    if (!TransactionService.instance) {\n      TransactionService.instance = new TransactionService();\n    }\n    return TransactionService.instance;\n  }\n\n  async saveTransaction(transaction: Transaction): Promise<void> {\n    // Simular API call\n    await new Promise(resolve => setTimeout(resolve, 500));\n    const transactions = this.getStoredTransactions();\n    transactions.push(transaction);\n    localStorage.setItem('transactions', JSON.stringify(transactions));\n  }\n\n  getStoredTransactions(): Transaction[] {\n    if (typeof window === 'undefined') return [];\n    const stored = localStorage.getItem('transactions');\n    return stored ? JSON.parse(stored) : [];\n  }\n\n  async deleteTransaction(id: string): Promise<void> {\n    const transactions = this.getStoredTransactions();\n    const filtered = transactions.filter(t => t.id !== id);\n    localStorage.setItem('transactions', JSON.stringify(filtered));\n  }\n}\n\nexport const transactionService = TransactionService.getInstance();"}]